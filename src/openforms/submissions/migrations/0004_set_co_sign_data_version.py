# Generated by Django 4.2.20 on 2025-04-28 15:41

from django.db import migrations
from django.db.migrations.state import StateApps


def set_co_sign_data_version(apps: StateApps, _):
    Submission = apps.get_model("submissions", "Submission")
    submissions = Submission.objects.exclude(co_sign_data={}).iterator()
    for submission in submissions:
        match submission.co_sign_data:
            case {"identifier": str()}:
                submission.co_sign_data["version"] = "v1"
            case {"value": str()}:
                submission.co_sign_data["version"] = "v2"
            case _:  # ignore garbage data
                continue
        submission.save(update_fields=("co_sign_data",))


class Migration(migrations.Migration):
    dependencies = [
        ("submissions", "0003_alter_submissionvaluevariable_unique_together_and_more"),
    ]

    operations = [
        migrations.RunPython(set_co_sign_data_version, migrations.RunPython.noop)
    ]
