# Generated by Django 4.2.16 on 2024-10-21 10:23

from django.db import migrations


def define_explicit_objects_api_groups(apps, schema_editor):
    ObjectsAPIGroupConfig = apps.get_model("objects_api", "ObjectsAPIGroupConfig")
    FormRegistrationBackend = apps.get_model("forms", "FormRegistrationBackend")

    # Behaviour before the objects API group could be defined explicity: always use the
    # objects API group with the lowest primary key
    objects_api_group = ObjectsAPIGroupConfig.objects.order_by("pk").first()
    for backend in FormRegistrationBackend.objects.filter(backend="zgw-create-zaak"):
        if not backend.options.get("objecttype"):
            backend.options["objects_api_group"] = None
        else:
            backend.options["objects_api_group"] = objects_api_group.pk
        backend.save()


class Migration(migrations.Migration):

    dependencies = [
        ("forms", "0001_initial_to_v250"),
        ("registrations_objects_api", "0016_objectsapigroupconfig"),
        ("zgw_apis", "0014_zgwapigroupconfig_catalogue_domain_and_more"),
    ]

    operations = [
        migrations.RunPython(
            define_explicit_objects_api_groups, migrations.RunPython.noop
        )
    ]
